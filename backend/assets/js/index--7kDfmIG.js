import{Z as k,_ as U,d as S,i as _,C as q,r as i,o as O,c as Y,b as l,w as o,u as f,a7 as j,e as b,a8 as F,a as w,ac as H,ad as P,Y as Z,T as h,ae as A,af as v,ag as y}from"./index-mkXm0lbT.js";import{_ as G}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-rajnjMkI.js";import"./_plugin-vue_export-helper-x3n3nnut.js";import"./sortable.esm-qwEfw145.js";const J=d=>(d.pageSize==null&&(d.pageSize=15),k.get(U+"/users/infoList",{pageNum:d.pageNum,pageSize:d.pageSize})),K=d=>k.put(U+"/users/infoList",d),Q=d=>k.delete(U+"/users/infoList",d),W={class:"table-box"},X={style:{display:"flex","align-items":"center"}},ee=w("span",null,"编辑用户",-1),te={style:{"text-align":"right"}},le=S({name:"menuMange"}),ue=S({...le,setup(d){_();const C=_(),a=_(),x=_(),z=function(e){p.value=!0,a.value=Z({...e}),x.value=e},D=e=>({list:e.list,total:e.total,pageNum:e.pageNum,pageSize:e.pageSize}),p=_(!1),E=async function(e){parseInt(a.value.coins);try{let{id:t,username:u,status:c,email:m,phone:r,coins:s,expired:g}=a.value;s=s-parseInt(x.value.coins);const{data:V}=await K({id:t,username:u,status:c,email:m,phone:r,coins:s,expired:g});V.status==0&&(h.success("更新成功"),Object.assign(x.value,a.value)),p.value=!1}catch{}},T=q({get:()=>a.value.expired?new Date(a.value.expired):null,set:e=>{if(e==null){a.value.expired=null;return}e=new Date(e);const t=e.getFullYear(),u=("0"+(e.getMonth()+1)).slice(-2),c=("0"+e.getDate()).slice(-2),m=("0"+e.getHours()).slice(-2),r=("0"+e.getMinutes()).slice(-2),s=("0"+e.getSeconds()).slice(-2);e=`${t}-${u}-${c} ${m}:${r}:${s}`,a.value.expired=e}}),N=function(e){A.confirm("是否确认删除当前用户?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{var t;try{const{data:u}=await Q({id:e.id});u.status==0&&(h.success("删除成功"),(t=C.value)==null||t.getTableList())}catch{}})},B=[{prop:"id",label:"ID",align:"left",isShow:!1},{prop:"username",label:"用户名",align:"left"},{prop:"status",label:"状态",render:({row:e})=>e.status===0?v(y,{type:"danger"},"正常"):v(y,{type:"warning"},"封禁")},{prop:"email",label:"邮箱"},{prop:"phone",label:"手机"},{prop:"type",label:"用户类型",render:({row:e})=>e.coins<=0||e.expired<new Date().getTime()&&e.expired!=null?v(y,{type:"info"},"免费会员"):v(y,{type:"success"},"付费会员")},{prop:"coins",label:"积分"},{prop:"used_coins",label:"已使用积分"},{prop:"expired",label:"会员到期日期"},{prop:"operation",label:"操作",width:250,fixed:"right"}];return(e,t)=>{const u=i("el-button"),c=i("Edit"),m=i("el-icon"),r=i("el-input"),s=i("el-form-item"),g=i("el-option"),V=i("el-select"),M=i("el-date-picker"),L=i("el-form"),I=i("el-card"),R=i("el-dialog");return O(),Y("div",W,[l(G,{ref_key:"proTable",ref:C,title:"菜单列表","row-key":"id","page-sizes":[15,25,50,100],columns:B,"request-api":f(J),"data-callback":D},{operation:o(n=>[l(u,{type:"primary",icon:f(j),onClick:$=>z(n.row)},{default:o(()=>[b(" 编辑 ")]),_:2},1032,["icon","onClick"]),l(u,{type:"danger",icon:f(F),onClick:$=>N(n.row)},{default:o(()=>[b(" 删除 ")]),_:2},1032,["icon","onClick"])]),_:1},8,["request-api"]),l(R,{modelValue:p.value,"onUpdate:modelValue":t[7]||(t[7]=n=>p.value=n),width:"500"},{header:o(()=>[w("div",X,[l(m,null,{default:o(()=>[l(c)]),_:1}),ee])]),default:o(()=>[l(I,null,{footer:o(n=>[w("div",te,[l(u,{type:"primary",icon:f(H),onClick:E},{default:o(()=>[b("确定")]),_:1},8,["icon"]),l(u,{onClick:t[6]||(t[6]=$=>p.value=!1),icon:f(P),type:"danger"},{default:o(()=>[b("取消")]),_:1},8,["icon"])])]),default:o(()=>[l(L,null,{default:o(()=>[l(s,{prop:"name",label:"用户名 :"},{default:o(()=>[l(r,{modelValue:a.value.username,"onUpdate:modelValue":t[0]||(t[0]=n=>a.value.username=n)},null,8,["modelValue"])]),_:1}),l(s,{style:{"padding-top":"10px"},label:"状态 :"},{default:o(()=>[l(V,{modelValue:a.value.status,"onUpdate:modelValue":t[1]||(t[1]=n=>a.value.status=n)},{default:o(()=>[l(g,{label:"正常",value:0}),l(g,{label:"封禁",value:1})]),_:1},8,["modelValue"])]),_:1}),l(s,{style:{"padding-top":"10px"},label:"邮箱 :"},{default:o(()=>[l(r,{modelValue:a.value.email,"onUpdate:modelValue":t[2]||(t[2]=n=>a.value.email=n)},null,8,["modelValue"])]),_:1}),l(s,{style:{"padding-top":"10px"},label:"手机 :"},{default:o(()=>[l(r,{modelValue:a.value.phone,"onUpdate:modelValue":t[3]||(t[3]=n=>a.value.phone=n)},null,8,["modelValue"])]),_:1}),l(s,{style:{"padding-top":"10px"},label:"积分操作+/- :"},{default:o(()=>[l(r,{modelValue:a.value.coins,"onUpdate:modelValue":t[4]||(t[4]=n=>a.value.coins=n),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),l(s,{style:{"padding-top":"10px"},label:"会员到期时间 :"},{default:o(()=>[l(M,{type:"datetime",modelValue:T.value,"onUpdate:modelValue":t[5]||(t[5]=n=>T.value=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{ue as default};
