import{d as q,i as h,r,o as z,c as N,b as e,w as l,a as y,u as b,a6 as F,e as V,a7 as R,a8 as H,ac as Y,ad as j,Y as A,T as g,ae as G,af as k,p as J,g as K,ag as T}from"./index-mkXm0lbT.js";import{_ as O}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-rajnjMkI.js";import{g as P,a as Q,u as X,d as Z}from"./cardType-Ct3DDCsj.js";import{_ as ee}from"./_plugin-vue_export-helper-x3n3nnut.js";import"./sortable.esm-qwEfw145.js";const U=w=>(J("data-v-58a61710"),w=w(),K(),w),le={class:"table-box"},te={style:{display:"flex","align-items":"center"}},ae=U(()=>y("div",null,[y("div",{style:{"margin-bottom":"5px","font-size":"15px"}},"卡密类型说明"),y("div",{style:{"font-size":"10px"}}," 新版本套餐分为不限时套餐和限时套餐、不限时充值次数永不过期、限时套餐在规定时间未使用完毕将清空、套餐等级为套餐优先级、等级越高价值越高、充值非永久套餐的限时套餐将成为会员、当已经是会员资格的情况下、充值低于自身等级的套餐仅添加自身余额不更新日期、充值大于等于自生等级的套餐的时候、将叠加余额与时间（请仔细阅读）,套餐有效时间设为-1即为永久不过期！ ")],-1)),ne={key:0,style:{display:"flex","align-items":"center"}},oe=U(()=>y("span",null,"编辑套餐",-1)),ie={key:1,style:{display:"flex","align-items":"center"}},ue=U(()=>y("span",null,"添加套餐",-1)),re={style:{"text-align":"right"}},se=q({__name:"index",setup(w){const x=h(),o=h({id:null,sort:null,name:null,coin:null,duration:null,price:null,discount:null}),C=h(!1),I=function(){C.value=!0,o.value={id:null,sort:null,name:null,coin:null,duration:null,price:null,discount:null},f.value=!0},B=h(),E=function(t){C.value=!1,f.value=!0,o.value=A({...t}),B.value=t},S=t=>({list:t.list,total:t.total,pageNum:t.pageNum,pageSize:t.pageSize}),f=h(!1),D=async function(t){var d,c;let{id:a,sort:i,name:p,coin:s,duration:u,price:_,discount:m}=o.value;if(i==null&&(i=0),p==null||p==""){g.error("套餐名不能为空");return}if(s==null){g.error("套餐积分不能为空");return}if(u==null){g.error("套餐时长不能为空");return}if(_==null){g.error("套餐价格不能为空");return}if(m==null&&(m=0),i=Number(i),s=Number(s),u=Number(u),_=Number(_),m=Number(m),C.value)try{const{data:v}=await Q({sort:i,name:p,coin:s,duration:u,price:_,discount:m});v.status==0&&(g.success("添加成功"),f.value=!1,(d=x.value)==null||d.getTableList())}catch{}else if(a!=null)try{const{data:v}=await X({id:a,sort:i,name:p,coin:s,duration:u,price:_,discount:m});v.status==0&&(g.success("添加成功"),f.value=!1,(c=x.value)==null||c.getTableList())}catch{}},W=function(t){G.confirm("是否确认删除当前套餐?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{var a;try{const{data:i}=await Z({id:t.id});i.status==0&&(g.success("删除成功"),(a=x.value)==null||a.getTableList())}catch{}})},L=[{prop:"id",label:"ID",align:"center",isShow:!1},{prop:"sort",label:"排序ID",align:"center",tag:!0},{prop:"name",label:"套餐名",align:"center",minWidth:200},{prop:"coin",label:"套餐积分",align:"center",tag:!0,minWidth:200,render:function(t){return k(T,{type:"success"},()=>`${t.row.coin}`)}},{prop:"duration",label:"套餐时长",align:"center",tag:!0,minWidth:200,render:function(t){return k(T,{type:"success"},()=>`${t.row.duration==-1?"无限制":t.row.duration+"天"}`)}},{prop:"price",label:"套餐价格",align:"center",tag:!0,minWidth:200,render:function(t){return k(T,{type:"primary"},()=>`${t.row.price+"元"}`)}},{prop:"discount",label:"套餐折扣",align:"center",minWidth:200,render:function(t){return k(T,{type:"primary"},()=>`${t.row.discount==0||t.row.discount==null?"无折扣":"-"+t.row.discount*10+"%"}`)}},{prop:"operation",label:"操作",width:200,fixed:"right"}];return(t,a)=>{const i=r("Connection"),p=r("el-icon"),s=r("el-card"),u=r("el-button"),_=r("Edit"),m=r("Fold"),d=r("el-input"),c=r("el-form-item"),v=r("el-form"),M=r("el-dialog");return z(),N("div",le,[e(s,null,{default:l(()=>[y("div",te,[e(p,{size:"35",color:"blue",style:{"margin-right":"10px"}},{default:l(()=>[e(i)]),_:1}),ae])]),_:1}),e(s,{style:{height:"80vh","margin-top":"10px"}},{default:l(()=>[e(O,{ref_key:"proTable",ref:x,"row-key":"id",height:"60vh",indent:20,"page-sizes":[15,25,50,100],columns:L,"request-api":b(P),"data-callback":S,"page-size":15,size:"small"},{tableHeader:l(n=>[e(u,{type:"success",icon:b(F),onClick:I},{default:l(()=>[V("新增套餐")]),_:1},8,["icon"])]),operation:l(n=>[e(u,{type:"primary",icon:b(R),size:"small",onClick:$=>E(n.row)},{default:l(()=>[V(" 编辑 ")]),_:2},1032,["icon","onClick"]),e(u,{type:"danger",icon:b(H),size:"small",onClick:$=>W(n.row)},{default:l(()=>[V(" 删除 ")]),_:2},1032,["icon","onClick"])]),_:1},8,["request-api"])]),_:1}),e(M,{modelValue:f.value,"onUpdate:modelValue":a[7]||(a[7]=n=>f.value=n),width:"700"},{header:l(()=>[C.value==!1?(z(),N("div",ne,[e(p,null,{default:l(()=>[e(_)]),_:1}),oe])):(z(),N("div",ie,[e(p,null,{default:l(()=>[e(m)]),_:1}),ue]))]),default:l(()=>[e(s,null,{footer:l(n=>[y("div",re,[e(u,{type:"primary",icon:b(Y),onClick:D},{default:l(()=>[V("确定")]),_:1},8,["icon"]),e(u,{onClick:a[6]||(a[6]=$=>f.value=!1),icon:b(j),type:"danger"},{default:l(()=>[V("取消")]),_:1},8,["icon"])])]),default:l(()=>[e(v,{"label-width":"auto"},{default:l(()=>[e(c,{prop:"sort",label:"排序ID :"},{default:l(()=>[e(d,{modelValue:o.value.sort,"onUpdate:modelValue":a[0]||(a[0]=n=>o.value.sort=n),type:"number",placeholder:"自定义展示顺序,默认0"},null,8,["modelValue"])]),_:1}),e(c,{prop:"name",label:"套餐名 :"},{default:l(()=>[e(d,{modelValue:o.value.name,"onUpdate:modelValue":a[1]||(a[1]=n=>o.value.name=n),placeholder:"自定义套餐名"},null,8,["modelValue"])]),_:1}),e(c,{prop:"coin",label:"积分 :"},{default:l(()=>[e(d,{modelValue:o.value.coin,"onUpdate:modelValue":a[2]||(a[2]=n=>o.value.coin=n),type:"number",placeholder:"自定义积分"},null,8,["modelValue"])]),_:1}),e(c,{prop:"duration",label:"时长 :"},{default:l(()=>[e(d,{modelValue:o.value.duration,"onUpdate:modelValue":a[3]||(a[3]=n=>o.value.duration=n),type:"number",placeholder:"自定义使用时长,-1 为不到期"},null,8,["modelValue"])]),_:1}),e(c,{prop:"coin",label:"价格 :"},{default:l(()=>[e(d,{modelValue:o.value.price,"onUpdate:modelValue":a[4]||(a[4]=n=>o.value.price=n),type:"number",placeholder:"自定义价格"},null,8,["modelValue"])]),_:1}),e(c,{prop:"coin",label:"折扣 :"},{default:l(()=>[e(d,{modelValue:o.value.discount,"onUpdate:modelValue":a[5]||(a[5]=n=>o.value.discount=n),type:"number",placeholder:"自定义折扣,默认无折扣,2 则代表8折 扣除20%设置的价格"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),_e=ee(se,[["__scopeId","data-v-58a61710"]]);export{_e as default};
