import{Z as w,_ as k,d as j,i as u,r as s,o as g,c as y,b as e,w as l,a as p,u as b,a6 as A,e as h,a8 as H,ac as P,ad as Z,F as G,f as J,T as x,ae as K,af as N,p as Q,g as X,ag as Y,h as ee}from"./index-mkXm0lbT.js";import{_ as te}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-rajnjMkI.js";import{g as le}from"./cardType-Ct3DDCsj.js";import{_ as ae}from"./_plugin-vue_export-helper-x3n3nnut.js";import"./sortable.esm-qwEfw145.js";const oe=a=>(a.pageSize==null&&(a.pageSize=15),w.get(k+"/card",{filter:a.filter,pageNum:a.pageNum,pageSize:a.pageSize})),ne=a=>w.delete(k+"/card/",a,{loading:!0}),se=a=>w.post(k+"/card/",a,{loading:!0}),re=async a=>{const m=await w.download(k+"/card/export/"+a+".txt"),r=window.URL.createObjectURL(new Blob([m])),d=document.createElement("a");d.href=r,d.setAttribute("download",a+".txt"),document.body.appendChild(d),d.click(),document.body.removeChild(d)},T=a=>(Q("data-v-34d41085"),a=a(),X(),a),ie={class:"table-box"},de={style:{display:"flex","align-items":"center"}},ce=T(()=>p("div",null,[p("div",{style:{"margin-bottom":"5px","font-size":"15px"}},"卡密生成"),p("div",{style:{"font-size":"10px"}},"生成卡密, 用于用户购买套餐时使用")],-1)),ue={key:0,style:{display:"flex","align-items":"center"}},pe=T(()=>p("span",null,"编辑套餐",-1)),_e={key:1,style:{display:"flex","align-items":"center"}},me=T(()=>p("span",null,"添加套餐",-1)),fe={style:{"text-align":"right"}},ge=j({__name:"index",setup(a){const m=u(),r=u({card_type_id:null,number:null,export:!1}),d=u(!0),S=u([]),C=u(!1),B=function(){C.value=!0,le({filter:1,pageNum:1,pageSize:1}).then(n=>{const{data:t}=n;S.value=t.data,d.value=!1}),r.value={card_type_id:null,number:null,export:!1},f.value=!0};u();const L=n=>({list:n.list,total:n.total,pageNum:n.pageNum,pageSize:n.pageSize}),f=u(!1),E=async function(n){var _;let{card_type_id:t,number:i}=r.value;if(t==null){x.error("请选择生成类别");return}if(i==null||i==0){x.error("请输入数量");return}if(t=Number(t),i=Number(i),C.value)try{const{data:c}=await se({card_type_id:t,number:i,export:r.value.export});c.status==0&&(x.success("添加成功"),r.value.export&&await re(c.addr),f.value=!1,(_=m.value)==null||_.getTableList())}catch{}},U=function(n){K.confirm("是否确认删除当前套餐?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{var t;try{const{data:i}=await ne({id:n.id});i.status==0&&(x.success("删除成功"),(t=m.value)==null||t.getTableList())}catch{}})},$=[{prop:"id",label:"ID",align:"center",isShow:!1},{prop:"name",label:"套餐名",align:"center",tag:!0},{prop:"card_no",label:"卡密",align:"center",minWidth:200},{prop:"use",label:"是否使用",align:"center",tag:!0,minWidth:200,render:function(n){return N(Y,{type:"success"},()=>`${n.row.use==0?"未使用":"已使用"}`)}},{prop:"username",label:"使用人",align:"center",minWidth:200},{prop:"created_at",label:"创建日期",align:"center",minWidth:200},{prop:"updated_at",label:"使用日期",align:"center",minWidth:200,render:function(n){return N("div",{},`${n.row.use==0?"--":n.row.updated_at}`)}},{prop:"operation",label:"操作",width:200,fixed:"right"}];return(n,t)=>{const i=s("Connection"),_=s("el-icon"),c=s("el-card"),v=s("el-button"),I=s("Edit"),W=s("Fold"),F=s("el-option"),R=s("el-select"),V=s("el-form-item"),M=s("el-input"),q=s("el-switch"),D=s("el-form"),O=s("el-dialog");return g(),y("div",ie,[e(c,null,{default:l(()=>[p("div",de,[e(_,{size:"35",color:"blue",style:{"margin-right":"10px"}},{default:l(()=>[e(i)]),_:1}),ce])]),_:1}),e(c,{style:{height:"80vh","margin-top":"10px"}},{default:l(()=>[e(te,{ref_key:"proTable",ref:m,"row-key":"id",height:"60vh",indent:20,"page-sizes":[15,25,50,100],columns:$,"request-api":b(oe),"data-callback":L,"page-size":15,size:"small"},{tableHeader:l(o=>[e(v,{type:"success",icon:b(A),onClick:B},{default:l(()=>[h("新增卡密")]),_:1},8,["icon"])]),operation:l(o=>[e(v,{type:"danger",icon:b(H),size:"small",onClick:z=>U(o.row)},{default:l(()=>[h(" 删除 ")]),_:2},1032,["icon","onClick"])]),_:1},8,["request-api"])]),_:1}),e(O,{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=o=>f.value=o),width:"700"},{header:l(()=>[C.value==!1?(g(),y("div",ue,[e(_,null,{default:l(()=>[e(I)]),_:1}),pe])):(g(),y("div",_e,[e(_,null,{default:l(()=>[e(W)]),_:1}),me]))]),default:l(()=>[e(c,null,{footer:l(o=>[p("div",fe,[e(v,{type:"primary",icon:b(P),onClick:E},{default:l(()=>[h("确定")]),_:1},8,["icon"]),e(v,{onClick:t[3]||(t[3]=z=>f.value=!1),icon:b(Z),type:"danger"},{default:l(()=>[h("取消")]),_:1},8,["icon"])])]),default:l(()=>[e(D,{"label-width":"auto"},{default:l(()=>[e(V,{label:"套餐名 :"},{default:l(()=>[e(R,{modelValue:r.value.card_type_id,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value.card_type_id=o),loading:d.value},{default:l(()=>[(g(!0),y(G,null,J(S.value,(o,z)=>(g(),ee(F,{key:z,label:`${o==null?void 0:o.name}`,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),e(V,{prop:"number",label:"需要生成的卡密数量 :"},{default:l(()=>[e(M,{modelValue:r.value.number,"onUpdate:modelValue":t[1]||(t[1]=o=>r.value.number=o),type:"number",placeholder:"需要生成的卡密数量"},null,8,["modelValue"])]),_:1}),e(V,{label:"是否导出 :"},{default:l(()=>[e(q,{modelValue:r.value.export,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value.export=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),we=ae(ge,[["__scopeId","data-v-34d41085"]]);export{we as default};
