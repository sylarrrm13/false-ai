import{Z as E,_ as N,d as Q,i as g,r as s,o as c,c as V,b as a,w as t,a as b,u as y,a6 as X,e as h,a7 as ee,a8 as le,ac as ae,ad as te,F as $,f as W,h as T,Y as D,ae as oe,T as k,af as F,ag as M,p as ne,g as ie,t as de}from"./index-mkXm0lbT.js";import{_ as ue}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-rajnjMkI.js";import{g as R}from"./modelCate-RZdHqOez.js";import{_ as se}from"./_plugin-vue_export-helper-x3n3nnut.js";import"./sortable.esm-qwEfw145.js";const re=i=>(i.pageSize==null&&(i.pageSize=15),E.get(N+"/modelKey",{pageNum:i.pageNum,pageSize:i.pageSize})),ce=i=>E.delete(N+"/modelKey/",i,{loading:!0}),pe=i=>E.put(N+"/modelKey/",i),_e=i=>E.post(N+"/modelKey/",i),U=i=>(ne("data-v-3afdd58a"),i=i(),ie(),i),me={class:"table-box"},fe={style:{display:"flex","align-items":"center"}},ve=U(()=>b("div",null,[b("div",{style:{"margin-bottom":"5px","font-size":"15px"}},"key卡池说明"),b("div",{style:{"font-size":"13px"}},"模型说明 启动的key就会调用、不启动则会关闭、一个key同时添加到多个模型！")],-1)),ge={key:0,style:{display:"flex","align-items":"center"}},ye=U(()=>b("span",null,"编辑KEY",-1)),be={key:1,style:{display:"flex","align-items":"center"}},he=U(()=>b("span",null,"添加KEY",-1)),ke={style:{"text-align":"right"}},we=Q({__name:"index",setup(i){const I=g(!0);g();const C=g(),n=g({id:null,model_cate_id:null,key:null,api_addr:null,weight:null,enable:null}),w=g([]),Y=o=>{const e=n.value.model_cate_id.indexOf(o);e!==-1&&n.value.model_cate_id.splice(e,1)},p=g(!1),A=function(){R({filter:1,pageNum:1,pageSize:1}).then(e=>{const{data:d}=e;w.value=d,I.value=!1}),p.value=!0,n.value={id:null,model_cate_id:null,key:null,api_addr:null,enable:null,weight:null},_.value=!0},B=g(),q=async function(o){w.value.length==0?R({filter:1,pageNum:1,pageSize:1}).then(e=>{const{data:d}=e;w.value=d,I.value=!1,p.value=!1,_.value=!0,n.value=D({...o}),n.value.model_cate_id=[o.model_cate_id],B.value=o}):(p.value=!1,_.value=!0,n.value=D({...o}),n.value.model_cate_id=[o.model_cate_id],B.value=o)},O=o=>({list:o.list,total:o.total,pageNum:o.pageNum,pageSize:o.pageSize}),P=function(o){oe.confirm("是否确认删除当前KEY?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e;try{const{data:d}=await ce({id:o.id});d.status==0&&(k.success("删除成功"),(e=C.value)==null||e.getTableList())}catch{}})},_=g(!1),H=async function(o){var z,K;let{id:e,key:d,model_cate_id:m,api_addr:f,enable:r,weight:v}=n.value;if(m==null||m.length==0){k.error("模型类别不能为空");return}if(d==null||d==""){k.error("密钥不能为空");return}if(f==null||f==""){k.error("api地址不能为空");return}r==null&&(r=0),v==null&&(v=1),v=parseInt(v);const L=d.split(`
`).filter(u=>u!="");if(p.value)try{const{data:u}=await _e({key:L,model_cate_id:m,api_addr:f,enable:r,weight:v});u.status==0&&(k.success("添加成功"),_.value=!1,(z=C.value)==null||z.getTableList())}catch{}else if(e!=null)try{const{data:u}=await pe({id:e,key:d,model_cate_id:m[0],api_addr:f,enable:r,weight:v});u.status==0&&(k.success("更新成功"),_.value=!1,(K=C.value)==null||K.getTableList())}catch{}},Z=[{prop:"id",label:"ID",align:"center",isShow:!1},{prop:"model_cate_name",label:"模型名称",tag:!0,align:"center",minWidth:100},{prop:"key",label:"密钥值",align:"center",minWidth:200},{prop:"api_addr",label:"api地址",align:"center",tag:!0,minWidth:200},{prop:"weight",label:"模型权重",align:"center",tag:!0},{prop:"enable",label:"启用",align:"center",tag:!0,render:function(o){return F(M,{type:o.row.enable==1?"success":"info"},()=>`${o.row.enable==1?"是":"否"}`)}},{prop:"tool",label:"工具模型",align:"center",tag:!0,render:function(o){return F(M,{type:o.row.tool==1?"success":"info"},()=>`${o.row.tool==1?"是":"否"}`)}},{prop:"operation",label:"操作",width:250,fixed:"right"}];return(o,e)=>{const d=s("Watermelon"),m=s("el-icon"),f=s("el-card"),r=s("el-button"),v=s("Edit"),L=s("Fold"),z=s("el-option"),K=s("el-select"),u=s("el-form-item"),S=s("el-input"),j=s("el-switch"),G=s("el-form"),J=s("el-dialog");return c(),V("div",me,[a(f,null,{default:t(()=>[b("div",fe,[a(m,{size:"35",color:"blue",style:{"margin-right":"10px"}},{default:t(()=>[a(d)]),_:1}),ve])]),_:1}),a(f,{style:{"margin-top":"10px"},height:"80vh"},{default:t(()=>[a(ue,{ref_key:"proTable",ref:C,"row-key":"id",indent:20,height:"60vh","page-sizes":[15,25,50,100],columns:Z,"page-size":15,"request-api":y(re),"data-callback":O},{tableHeader:t(l=>[a(r,{type:"success",icon:y(X),onClick:A},{default:t(()=>[h("新增Key")]),_:1},8,["icon"])]),operation:t(l=>[a(r,{type:"primary",icon:y(ee),onClick:x=>q(l.row)},{default:t(()=>[h(" 编辑 ")]),_:2},1032,["icon","onClick"]),a(r,{type:"danger",icon:y(le),onClick:x=>P(l.row)},{default:t(()=>[h(" 删除 ")]),_:2},1032,["icon","onClick"])]),_:1},8,["request-api"])]),_:1}),a(J,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value=l),width:"700"},{header:t(()=>[p.value==!1?(c(),V("div",ge,[a(m,null,{default:t(()=>[a(v)]),_:1}),ye])):(c(),V("div",be,[a(m,null,{default:t(()=>[a(L)]),_:1}),he]))]),default:t(()=>[a(f,null,{footer:t(l=>[b("div",ke,[a(r,{type:"primary",icon:y(ae),onClick:H},{default:t(()=>[h("确定")]),_:1},8,["icon"]),a(r,{onClick:e[6]||(e[6]=x=>_.value=!1),icon:y(te),type:"danger"},{default:t(()=>[h("取消")]),_:1},8,["icon"])])]),default:t(()=>[a(G,{"label-width":"auto"},{default:t(()=>[a(u,{prop:"models",label:"模型类别 :"},{default:t(()=>[a(K,{modelValue:n.value.model_cate_id,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value.model_cate_id=l),multiple:"","default-first-option":"","reserve-keyword":!1,placeholder:"选择你的模型类别",disabled:p.value==!1,loading:I.value},{tag:t(()=>[(c(!0),V($,null,W(n.value.model_cate_id,l=>(c(),T(y(M),{key:l.value,type:"success",closable:p.value==!0,onClose:x=>Y(l)},{default:t(()=>[h(de(w.value.find(x=>x.id==l).name),1)]),_:2},1032,["closable","onClose"]))),128))]),default:t(()=>[(c(!0),V($,null,W(w.value,l=>(c(),T(z,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled","loading"])]),_:1}),a(u,{prop:"weight",label:"key权重 :"},{default:t(()=>[a(S,{type:"number",modelValue:n.value.weight,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.weight=l),placeholder:"请输入Key权重,默认为1"},null,8,["modelValue"])]),_:1}),a(u,{label:"启用该key :"},{default:t(()=>[a(j,{modelValue:n.value.enable,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.enable=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),a(u,{prop:"name",label:"密钥 :"},{default:t(()=>[p.value?(c(),T(S,{key:0,modelValue:n.value.key,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.key=l),type:"textarea",placeholder:"请输入密钥一行一个可以批量加入",autosize:{minRows:10}},null,8,["modelValue"])):(c(),T(S,{key:1,modelValue:n.value.key,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.key=l),placeholder:"请输入密钥"},null,8,["modelValue"]))]),_:1}),a(u,{prop:"apiAddr",label:"api地址 :"},{default:t(()=>[a(S,{modelValue:n.value.api_addr,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.api_addr=l),placeholder:"请输入API 地址.满足openAI调用格式均可"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Se=se(we,[["__scopeId","data-v-3afdd58a"]]);export{Se as default};
